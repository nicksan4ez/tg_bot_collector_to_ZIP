# Telegram Archive Bot

Бот на aiogram, который принимает серии видео с подписями от заранее разрешённых пользователей, переименовывает файлы по подписи и возвращает архив с обработанными роликами.

## Возможности
- Авторизация по списку `ALLOWED_USER_IDS`, остальные пользователи игнорируются без ответа.
- После получения видео бот ждёт `ARCHIVE_BUILD_DELAY` секунд и предлагает собрать архив кнопками «Да»/«Игнорировать».
- Сохраняет ролики во временную директорию, очищая только недопустимые символы в именах.
- Собирает файлы в ZIP; при превышении `ARCHIVE_SIZE_LIMIT_MB` делит архив на тома (`Имя.zip.001`, `Имя.zip.002`, …).
- Сообщает о файлах, которые не скачались или не прошли по лимиту, и удаляет временные данные.
- Логирует события в консоль и файл `LOG_FILE`.

## Конфигурация

1. Скопируйте `.env.example` в `.env` и задайте значения:
   - `BOT_TOKEN` — токен бота из BotFather.
   - `ALLOWED_USER_IDS` — ID авторизованных пользователей через запятую.
   - `ARCHIVE_NAME` — имя итогового архива (обязательно `.zip`).
   - `TEMP_ROOT` — путь к каталогу временных файлов.
   - `ARCHIVE_BUILD_DELAY` — задержка перед показом кнопок (в секундах).
   - `DOWNLOAD_TIMEOUT` — таймаут скачивания одного файла (в секундах).
   - `ARCHIVE_SIZE_LIMIT_MB` — максимальный размер одного архива (в мегабайтах).
   - `LOG_FILE` — путь к файлу логов.
   - `LOG_LEVEL` — уровень логирования (INFO, DEBUG и т.д.).

## Локальный запуск

```bash
pip install -r requirements.txt
python main.py
```

## Docker Compose

```bash
docker compose up -d --build
```

Команда соберёт образ и поднимет сервис `tg_bot_collector_to_ZIP` с политикой перезапуска `unless-stopped`. Логи попадают в `logs/bot.log`, временные файлы — в `temp/`.

### Обновление на сервере (Git + Docker Compose)
1. На локальной машине закоммитьте изменения и выполните `git push`.
2. На VDS:
   ```bash
   cd ~/tg-bot
   git pull
   docker compose up -d --build
   ```
   Compose пересоберёт образ и перезапустит сервис без дополнительных команд.

## Структура проекта

```
app/
├── bot.py              # Основная логика бота
├── logging_setup.py    # Настройка логирования
└── settings.py         # Загрузка конфигурации из .env
main.py                 # Точка входа
requirements.txt        # Список зависимостей
Dockerfile              # Сборка образа
.dockerignore           # Исключения из контекста сборки
docker-compose.yml      # Конфигурация Docker Compose
README.md               # Документация
```
