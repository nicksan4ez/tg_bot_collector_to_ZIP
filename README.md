# Telegram Archive Bot

Бот на aiogram для авторизованного сбора видео, которые отправляются сообщениями с подписями, переименования файлов и возврата ZIP-архивов пользователю.

## Конфигурация

1. Скопируйте `.env.example` в `.env` и заполните значения:
   - `BOT_TOKEN` — токен бота.
   - `ALLOWED_USER_IDS` — список ID через запятую для авторизованных пользователей.
   - `ARCHIVE_NAME` — имя итогового архива (`.zip`).
   - `TEMP_ROOT` — каталог для временных файлов.
   - `ARCHIVE_BUILD_DELAY` — задержка (сек.) перед запросом на сбор архива.
   - `DOWNLOAD_TIMEOUT` — таймаут скачивания одного файла (сек.).
   - `ARCHIVE_SIZE_LIMIT_MB` — максимальный размер одного архива, отправляемого ботом (МБ).
   - `LOG_FILE` — путь к файлу логов.
   - `LOG_LEVEL` — уровень логирования.

## Поведение

- Бот работает только с пользователями из `ALLOWED_USER_IDS` и игнорирует остальных без ответа.
- После получения видео ждёт указанную задержку и предлагает собрать архив через кнопки "Да"/"Игнорировать".
- Файлы сохраняются с именами из подписей; запрещённые символы заменяются на подчёркивания.
- Если суммарный размер превышает лимит, бот создаёт многотомный архив и отправляет тома вида `Имя.zip.001`, `Имя.zip.002` и т.д.
- Для файлов, которые нельзя скачать или которые не помещаются в лимит, отправляется отдельное уведомление.
- После завершения обработки временные данные удаляются, логи пишутся в stdout и `LOG_FILE`.

## Локальный запуск

```bash
pip install -r requirements.txt
python main.py
```

## Docker

Сборка образа:

```bash
docker build -t tg-archive-bot .
```

Запуск контейнера (пример):

```bash
docker run --rm \
  --name tg-archive-bot \
  --env-file .env \
  -v "$(pwd)/logs:/app/logs" \
  -v "$(pwd)/temp:/app/temp" \
  tg-archive-bot
```

Контейнер корректно завершается по Ctrl+C / SIGINT. Для автозапуска можно добавить `--restart unless-stopped` или настроить docker-compose.
