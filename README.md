<<<<<<< HEAD
TG_as_file_bot
=================

Коротко
-------
Небольшой Telegram-бот, который принимает видео/документы от разрешённых пользователей, сохраняет их во временную папку, переименовывает (с добавлением расширения), собирает все присланные файлы и отправляет один ZIP-архив пользователю.

Файлы созданные в проекте
-------------------------
- bot.py — основной код бота
- .env — конфигурация (файл в корне, не храните в публичных репозиториях)
- .gitignore — исключения для git
- telegram_bot_media/ — временная папка (по умолчанию)

Требования
----------
- Python 3.9+
- Библиотеки: python-telegram-bot, python-dotenv (см. requirements.txt)

Установка
---------
1. Скопировать репозиторий.
2. Создать виртуальное окружение и активировать его.
3. Установить зависимости:

    pip install -r requirements.txt

Конфигурация (.env)
-------------------
Создайте или отредактируйте .env в корне проекта. Обязательные и опциональные переменные:

- BOT_TOKEN — токен Telegram-бота (обязательно)
- ALLOWED_USERS — через запятую список user_id, которым разрешён доступ (оставьте пустым, чтобы разрешить всем)
- TMP_ROOT — путь к корню временных файлов (по умолчанию: ./telegram_bot_media)
- ZIP_NAME — имя отправляемого архива (по умолчанию: Monitor.zip)
- ARCHIVE_DELAY — задержка (сек) перед созданием архива после получения последнего файла (по умолчанию: 5)

Запуск
------
1. Убедитесь, что BOT_TOKEN указан в .env.
2. Запустите бота:

    python bot.py

Поведение
---------
- Бот сохраняет присланные файлы в TMP_ROOT/user_<user_id>/
- После паузы ARCHIVE_DELAY (после последнего полученного файла) бот упаковывает все сохранённые файлы в один архив и отправляет его в тот же чат.
- Все временные файлы и папка пользователя удаляются после отправки архива.

Отладка
------
- Логи пишутся в stdout. Проверьте сообщения logger.info / logger.exception при ошибках.
- Если архив не содержит расширений — проверьте MIME-информацию и file_path в логах.

Безопасность
-----------
- Не храните BOT_TOKEN в публичных репозиториях. .gitignore уже настроен для исключения .env и временных директорий.

Лицензия
--------
MIT (по умолчанию) — при необходимости замените.

Контакты
--------
Если нужно — могу помочь с доработками: контроль коллизий имён, прогресс загрузки, лимиты размера и т.п.

=======
﻿# Telegram Archive Bot

Бот на aiogram, который принимает серии видео с подписями от заранее разрешённых пользователей, переименовывает файлы по подписи и возвращает архив с обработанными роликами.

## Возможности
- Авторизация по списку `ALLOWED_USER_IDS`, остальные пользователи игнорируются без ответа.
- После получения видео бот ждёт `ARCHIVE_BUILD_DELAY` секунд и предлагает собрать архив кнопками «Да»/«Игнорировать».
- Сохраняет ролики во временную директорию, очищая только недопустимые символы в именах.
- Собирает файлы в ZIP; при превышении `ARCHIVE_SIZE_LIMIT_MB` делит архив на тома (`Имя.zip.001`, `Имя.zip.002`, …).
- Сообщает о файлах, которые не скачались или не прошли по лимиту, и удаляет временные данные.
- Логирует события в консоль и файл `LOG_FILE`.

## Конфигурация

1. Скопируйте `.env.example` в `.env` и задайте значения:
   - `BOT_TOKEN` — токен бота из BotFather.
   - `ALLOWED_USER_IDS` — ID авторизованных пользователей через запятую.
   - `ARCHIVE_NAME` — имя итогового архива (обязательно `.zip`).
   - `TEMP_ROOT` — путь к каталогу временных файлов.
   - `ARCHIVE_BUILD_DELAY` — задержка перед показом кнопок (в секундах).
   - `DOWNLOAD_TIMEOUT` — таймаут скачивания одного файла (в секундах).
   - `ARCHIVE_SIZE_LIMIT_MB` — максимальный размер одного архива (в мегабайтах).
   - `LOG_FILE` — путь к файлу логов.
   - `LOG_LEVEL` — уровень логирования (INFO, DEBUG и т.д.).

## Локальный запуск

```bash
pip install -r requirements.txt
python main.py
```

## Docker Compose

```bash
docker compose up -d --build
```

Команда соберёт образ и поднимет сервис `tg_bot_collector_to_ZIP` с политикой перезапуска `unless-stopped`. Логи попадают в `logs/bot.log`, временные файлы — в `temp/`.


## Структура проекта

```
app/
├── bot.py              # Основная логика бота
├── logging_setup.py    # Настройка логирования
└── settings.py         # Загрузка конфигурации из .env
main.py                 # Точка входа
requirements.txt        # Список зависимостей
Dockerfile              # Сборка образа
.dockerignore           # Исключения из контекста сборки
docker-compose.yml      # Конфигурация Docker Compose
README.md               # Документация
```
>>>>>>> bba2b88fb528a473ace533b0d53555aa4b2525a4
